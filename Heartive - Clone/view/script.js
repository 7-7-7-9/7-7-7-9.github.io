let videoGrid=document.getElementById("videoGrid"),title=document.getElementById("back"),provided_ids=window.location.hash.substring(2).toLowerCase().split("/"),show_id=provided_ids[1],season_id=provided_ids[2];function parseRuntime(e){var t=Math.floor(e/60),e=e%60+"m";return 0<t?t+"h"+("0m"!=e?" "+e:""):"0m"==e?"N/A":e}let titleDocument=function(e,t){e.first_air_date?document.title=`${e.name} (${e.first_air_date.split("-")[0]}) Season ${t} Â· Heartive`:document.title=e.name+` Season ${t} Â· Heartive`};function getImage(e){return null==e?"../previews/no-episode.png":"https://image.tmdb.org/t/p/w500"+e}themoviedb(`tv/${show_id}?language=en-US&append_to_response=external_ids`).then(e=>e.json()).then(p=>{let m=p.seasons.find(e=>e.id==season_id).season_number;titleDocument(p,m),title.innerHTML=`<img draggable="false" class="emoji" alt="" src="../previews/branding/favicon-128x128.png"> Heartive - ${oranj(p.name)} <i class="fas fa-layer-group"></i> `+oranj("Season "+m),title.setAttribute("href",`../seasons/#/${slugify(p.name,{lower:!0,strict:!0})}/`+show_id),themoviedb(`tv/${show_id}/season/${m}?language=en-US`).then(e=>e.json()).then(e=>{e.episodes.forEach(e=>{let t={type:"Series",title:p.name,year:p.first_air_date.split("-")[0],poster:getImage(e.still_path),season:m.toString(),totalSeasons:(p?.number_of_seasons||0).toString(),episode:e.episode_number.toString(),totalEpisodes:(p?.number_of_episodes||0).toString(),seasonNumber:Number(m),totalSeasonsNumber:Number(p?.number_of_seasons||0),episodeNumber:Number(e.episode_number),totalEpisodesNumber:Number(p?.number_of_episodes||0),seasonId:season_id.toString(),episodeId:e.id.toString(),tmdbId:show_id.toString(),imdbId:p?.external_ids?.imdb_id||null};var n=document.createElement("div");n.classList.add("videoItem");let a=document.createElement("a");a.classList.add("thumbnail"),a.target="_blank",a.rel="noopener noreferrer";var i=document.createElement("img"),s=(i.loading="lazy",i.src=getImage(e.still_path),a.appendChild(i),hasOverride(t,a)),i=(a.addEventListener("click",async()=>{document.body.querySelector(".modal")||(s||loadEmbeds(t),watched.add("e-"+t.episodeId),addCheckmark("e-"+t.episodeId,a))}),document.createElement("div"));i.classList.add("playIcon"),i.innerHTML="<i class='fas fa-play'></i>",a.appendChild(i);let d=document.createElement("div");d.classList.add("timeOverlay"),"N/A"!==parseRuntime(e.runtime)?(t.runtime=e.runtime,d.innerText=parseRuntime(e.runtime)+" â— "+parseEndTime(e.runtime),setInterval(()=>{try{d.innerText=parseRuntime(e.runtime)+" â— "+parseEndTime(e.runtime)}catch(e){}},2250)):d.innerText=parseRuntime(e.runtime),a.appendChild(d),d.addEventListener("click",e=>{e.stopPropagation()}),watched.has("e-"+t.episodeId)&&addCheckmark("e-"+t.episodeId,a),t.imdbId&&!inFuture(e.air_date)&&((i=document.createElement("div")).classList.add("tor"),i.addEventListener("click",e=>{e.stopPropagation()}),(r=document.createElement("a")).innerHTML='<i class="fa-solid fa-magnet"></i>',r.href=`../torrents?id=${t.imdbId}&season=${t.season}&episode=`+t.episode,r.target="_blank",r.rel="noopener noreferrer",i.appendChild(r),a.appendChild(i),tippy)&&tippy(r,{content:"View torrents in new tab",animation:"shift-away-subtle"});var i=document.createElement("h3"),r=document.createElement("span"),o=(r.innerHTML=oranj(e.episode_number+". "),document.createTextNode(e.name)),l=(!inFuture(e.air_date)&&dateIsRecent(e.air_date)&&((l=document.createElement("img")).setAttribute("draggable",!1),l.classList.add("emoji"),l.setAttribute("alt",""),l.setAttribute("src","../previews/icons/new-24x24.png"),i.appendChild(l)),i.appendChild(r),i.appendChild(o),document.createElement("p"));l.innerText=e.overview,n.appendChild(a),n.appendChild(i),n.appendChild(l),inFuture(e.air_date)&&(n.style.opacity="0.5",n.style.filter="grayscale(100%)",n.style.pointerEvents="none",(r=document.createElement("div")).textContent=e.air_date?properDate(e.air_date):"",r.style.position="absolute",r.style.top="50%",r.style.left="50%",r.style.transform="translate(-50%, -50%)",r.style.fontSize="24px",r.style.textShadow="1px 1px 0 black, -1px -1px 0 black, 1px -1px 0 black, -1px 1px 0 black, 2px 2px 0 black, -2px -2px 0 black",a.appendChild(r)),videoGrid.appendChild(n)})})});
